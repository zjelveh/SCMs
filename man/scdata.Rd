% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scdata.R
\name{scdata}
\alias{scdata}
\title{Create Synthetic Control Data Structure}
\usage{
scdata(
  df,
  id.var,
  time.var,
  outcome.var,
  period.pre,
  period.post,
  unit.tr,
  unit.co,
  anticipation = 0,
  constant = FALSE,
  verbose = TRUE,
  covagg = list(),
  cointegrated.data = FALSE
)
}
\arguments{
\item{df}{Data frame containing the panel data in long format.}

\item{id.var}{Character. Name of the column containing unit identifiers (e.g., state names, country codes).}

\item{time.var}{Character. Name of the column containing time periods (e.g., year, quarter).}

\item{outcome.var}{Character. Name of the column containing the outcome variable of interest.}

\item{period.pre}{Numeric vector. Pre-treatment time periods used for fitting the synthetic control.}

\item{period.post}{Numeric vector. Post-treatment time periods for evaluating treatment effects.}

\item{unit.tr}{Character. Name or identifier of the treated unit.}

\item{unit.co}{Character vector. Names or identifiers of the potential control units (donor pool).}

\item{anticipation}{Numeric. Number of pre-treatment periods to exclude due to anticipation effects. Default is 0.}

\item{constant}{Logical. Whether to include a global constant (intercept) term in synthetic control estimation.
When TRUE, adds a constant feature that allows the synthetic control to have a level shift relative to donors.
Requires multiple features (more than one covariate specification). The constant term is estimated alongside
donor weights and can be positive or negative. Default is FALSE.}

\item{verbose}{Logical. Whether to print diagnostic messages and warnings. Default is TRUE.}

\item{covagg}{List of covariate-aggregation operations.
Each entry must be a list with:
\itemize{
\item \code{var}: variable name, or \code{"outcome_var"} for \code{outcome.var}
\item \code{select_periods}: optional period selector
\item \code{partition_periods}: optional grouping of selected periods
\item \code{compute}: optional aggregation function/function name (default \code{"mean"})
}
If \code{covagg} is empty, \code{scdata()} defaults to outcome per-period matching
over all pre-treatment periods.}

\item{cointegrated.data}{Logical. Whether to treat the data as cointegrated (affects some computations). Default is FALSE.}
}
\value{
A list of class 'scdata' containing:
\itemize{
\item \code{Y.pre}: Matrix of pre-treatment outcomes (controls Ã— time periods)
\item \code{Y.post}: Matrix of post-treatment outcomes
\item \code{Y.donors}: Full outcome matrix for donor units
\item \code{Y.treated}: Outcome vector for treated unit
\item \code{specs}: List containing specification details
\item Additional metadata for estimation and plotting
}
}
\description{
This function prepares a data structure for use with Synthetic Control Methods (SCM)
by formatting and organizing the input data. It validates inputs, structures the data appropriately,
and creates matrices needed for synthetic control estimation.
}
\details{
This function performs several key operations:
\itemize{
\item Validates that all required variables exist in the data
\item Checks for balanced panel structure
\item Creates outcome matrices for treated and control units
\item Handles missing data appropriately
\item Prepares data structures required by estimation functions
}

The function expects panel data in long format where each row represents one unit-time observation.
}
\examples{
\dontrun{
# Basic usage with state-level data
scm_data <- scdata(df = state_panel, 
                   id.var = "state", 
                   time.var = "year", 
                   outcome.var = "gdp_per_capita",
                   period.pre = 1980:1999, 
                   period.post = 2000:2010,
                   unit.tr = "California", 
                   unit.co = c("New York", "Texas", "Florida"))
                   
# With anticipation effects
scm_data <- scdata(df = policy_data,
                   id.var = "country",
                   time.var = "year", 
                   outcome.var = "unemployment_rate",
                   period.pre = 1990:2004,
                   period.post = 2007:2015,
                   unit.tr = "Germany",
                   unit.co = c("France", "Italy", "Spain"),
                   anticipation = 2)  # Exclude 2 pre-treatment years
                   
# Outcome per-period + covariate means
scm_data_ops <- scdata(df = germany_data,
                       id.var = "country",
                       time.var = "year",
                       outcome.var = "gdp",
                       period.pre = 1960:1990,
                       period.post = 1991:2003,
                       unit.tr = "West Germany",
                       unit.co = c("USA", "UK", "France"),
                       covagg = list(
                         list(
                           var = "outcome_var",
                           partition_periods = list(type = "by_period")
                         ),
                         list(var = "investment", compute = "mean"),
                         list(var = "trade", compute = "mean")
                       ))
                         
# With constant term (requires multiple features)
scm_data_const <- scdata(df = germany_data,
                         id.var = "country",
                         time.var = "year", 
                         outcome.var = "gdp",
                         period.pre = 1960:1990,
                         period.post = 1991:2003,
                         unit.tr = "West Germany",
                         unit.co = c("USA", "UK", "France"),
                         constant = TRUE,  # Enable constant term
                         covagg = list(
                           list(var = "outcome_var", partition_periods = list(type = "by_period")),
                           list(var = "investment", compute = "mean"),
                           list(
                             var = "trade",
                             select_periods = list(type = "explicit", periods = c(1985, 1990))
                           )
                         ))
}
}
