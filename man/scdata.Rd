% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scdata.R
\name{scdata}
\alias{scdata}
\title{Create Synthetic Control Data Structure}
\usage{
scdata(
  df,
  id.var,
  time.var,
  outcome.var,
  period.pre,
  period.post,
  unit.tr,
  unit.co,
  anticipation = 0,
  constant = FALSE,
  verbose = TRUE,
  covagg = list(),
  default_agg = NULL,
  cointegrated.data = FALSE
)
}
\arguments{
\item{df}{Data frame containing the panel data in long format.}

\item{id.var}{Character. Name of the column containing unit identifiers (e.g., state names, country codes).}

\item{time.var}{Character. Name of the column containing time periods (e.g., year, quarter).}

\item{outcome.var}{Character. Name of the column containing the outcome variable of interest.}

\item{period.pre}{Numeric vector. Pre-treatment time periods used for fitting the synthetic control.}

\item{period.post}{Numeric vector. Post-treatment time periods for evaluating treatment effects.}

\item{unit.tr}{Character. Name or identifier of the treated unit.}

\item{unit.co}{Character vector. Names or identifiers of the potential control units (donor pool).}

\item{anticipation}{Numeric. Number of pre-treatment periods to exclude due to anticipation effects. Default is 0.}

\item{constant}{Logical. Whether to include a global constant (intercept) term in synthetic control estimation.
When TRUE, adds a constant feature that allows the synthetic control to have a level shift relative to donors.
Requires multiple features (more than one covariate specification). The constant term is estimated alongside
donor weights and can be positive or negative. Default is FALSE.}

\item{verbose}{Logical. Whether to print diagnostic messages and warnings. Default is TRUE.}

\item{covagg}{List. Flexible specification for covariate aggregation.
Two formats are supported:
\itemize{
\item \strong{Simplified format} (recommended for spec grids):
\code{list(label = "...", per_period = c(...), pre_period_mean = c(...))}.
Use \code{"outcome_var"} to refer to \code{outcome.var}.
\item \strong{Traditional format} (fine-grained control): each element is
a list with \code{var} and optional controls
\code{periods}/\code{first}/\code{last}, \code{each}, and
\code{agg_fun}/\code{aggfunc}.
}
Examples of traditional entries:
\itemize{
\item \code{list(var = "gdp")} - Mean over full pre-period (default behavior)
\item \code{list(var = "gdp", each = TRUE)} - Separate feature for each period
\item \code{list(var = "invest", periods = c(1980, 1985))} - Specific periods (averaged)
\item \code{list(var = "gdp", first = 3)} - First N pre-periods (averaged)
\item \code{list(var = "industry", last = 2)} - Last N pre-periods (averaged)
\item \code{list(var = "gdp", last = 5, agg_fun = median)} - Custom aggregation
}
Rules: do not mix simplified and traditional keys inside the same specification,
and use only one of \code{periods}, \code{first}, or \code{last} per traditional entry.
Default is empty list.}

\item{default_agg}{List. Optional default aggregation specification for simplified covariate processing.
Contains three fields:
\itemize{
\item \code{outcome_agg}: Character. How to aggregate outcome variable ("mean", "per_period").
If NULL, no outcome variable added to matching matrices.
\item \code{features}: Character vector. Explicit list of variable names to include.
\item \code{features_agg}: Character. How to aggregate feature variables ("mean", "per_period").
Required when features are specified.
}
Variables specified in both default_agg and covagg will use covagg specification (with warning).
Default is NULL.}

\item{cointegrated.data}{Logical. Whether to treat the data as cointegrated (affects some computations). Default is FALSE.}
}
\value{
A list of class 'scdata' containing:
\itemize{
\item \code{Y.pre}: Matrix of pre-treatment outcomes (controls Ã— time periods)
\item \code{Y.post}: Matrix of post-treatment outcomes
\item \code{Y.donors}: Full outcome matrix for donor units
\item \code{Y.treated}: Outcome vector for treated unit
\item \code{specs}: List containing specification details
\item Additional metadata for estimation and plotting
}
}
\description{
This function prepares a data structure for use with Synthetic Control Methods (SCM)
by formatting and organizing the input data. It validates inputs, structures the data appropriately,
and creates matrices needed for synthetic control estimation.
}
\details{
This function performs several key operations:
\itemize{
\item Validates that all required variables exist in the data
\item Checks for balanced panel structure
\item Creates outcome matrices for treated and control units
\item Handles missing data appropriately
\item Prepares data structures required by estimation functions
}

The function expects panel data in long format where each row represents one unit-time observation.
}
\examples{
\dontrun{
# Basic usage with state-level data
scm_data <- scdata(df = state_panel, 
                   id.var = "state", 
                   time.var = "year", 
                   outcome.var = "gdp_per_capita",
                   period.pre = 1980:1999, 
                   period.post = 2000:2010,
                   unit.tr = "California", 
                   unit.co = c("New York", "Texas", "Florida"))
                   
# With anticipation effects
scm_data <- scdata(df = policy_data,
                   id.var = "country",
                   time.var = "year", 
                   outcome.var = "unemployment_rate",
                   period.pre = 1990:2004,
                   period.post = 2007:2015,
                   unit.tr = "Germany",
                   unit.co = c("France", "Italy", "Spain"),
                   anticipation = 2)  # Exclude 2 pre-treatment years
                   
# With flexible covariate aggregation (ADH-style)
scm_data_adh <- scdata(df = germany_data,
                       id.var = "country",
                       time.var = "year",
                       outcome.var = "gdp", 
                       period.pre = 1960:1990,
                       period.post = 1991:2003,
                       unit.tr = "West Germany",
                       unit.co = c("USA", "UK", "France"),
                       covagg = list(
                         gdp_each = list(var = "gdp", each = TRUE),
                         investment_avg = list(var = "investment"),
                         schooling_last5 = list(var = "schooling", last = 5),
                         trade_final = list(var = "trade", periods = 1990)
                       ))
                       
# With simplified default aggregation
scm_data_simple <- scdata(df = germany_data,
                          id.var = "country",
                          time.var = "year",
                          outcome.var = "gdp",
                          period.pre = 1960:1990,
                          period.post = 1991:2003,
                          unit.tr = "West Germany", 
                          unit.co = c("USA", "UK", "France"),
                          default_agg = list(
                            outcome_agg = "mean",              # Mean outcome for matching
                            features = c("investment", "trade"), # Explicit feature list
                            features_agg = "per_period"        # Per-period features
                          ))
                          
# Mixed approach: default_agg + custom covagg
scm_data_mixed <- scdata(df = germany_data,
                         id.var = "country", 
                         time.var = "year",
                         outcome.var = "gdp",
                         period.pre = 1960:1990,
                         period.post = 1991:2003,
                         unit.tr = "West Germany",
                         unit.co = c("USA", "UK", "France"),
                         default_agg = list(
                           outcome_agg = "per_period",
                           features = c("investment", "trade"),
                           features_agg = "mean"
                         ),
                         covagg = list(
                           schooling_custom = list(var = "schooling", last = 5)
                         ))

# With simplified covagg format
scm_data_simplified <- scdata(df = germany_data,
                              id.var = "country",
                              time.var = "year",
                              outcome.var = "gdp",
                              period.pre = 1960:1990,
                              period.post = 1991:2003,
                              unit.tr = "West Germany",
                              unit.co = c("USA", "UK", "France"),
                              covagg = list(
                                "Outcome + Covariates" = list(
                                  label = "Outcome + Covariates",
                                  per_period = "outcome_var",
                                  pre_period_mean = c("investment", "trade")
                                )
                              ))
                         
# With constant term (requires multiple features)
scm_data_const <- scdata(df = germany_data,
                         id.var = "country",
                         time.var = "year", 
                         outcome.var = "gdp",
                         period.pre = 1960:1990,
                         period.post = 1991:2003,
                         unit.tr = "West Germany",
                         unit.co = c("USA", "UK", "France"),
                         constant = TRUE,  # Enable constant term
                         covagg = list(
                           gdp_avg = list(var = "gdp"),
                           investment_avg = list(var = "investment"),
                           trade_periods = list(var = "trade", periods = c(1985, 1990))
                         ))
}
}
